[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-11-30 19:09:39.663958",
  "module": null,
  "name": "list",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Material Request",
  "script": "# پاکسازی conditions اولیه\ncleanconditions = []\n\nif conditions:\n    for item in conditions:\n        if isinstance(item, str):\n            cleanconditions.append(item)\n        elif isinstance(item, (list, tuple)):\n            for s in item:\n                if isinstance(s, str):\n                    cleanconditions.append(s)\n\nconditions = cleanconditions or []\n\n# گرفتن نقش‌ها از جدول Has Role\nroles = [r[0] for r in frappe.db.sql(\n    \"SELECT role FROM `tabHas Role` WHERE parent=%s\", user\n)]\n\n# محدودیت برای Purchase Manager\nif \"Purchase Manager\" in roles:\n    conditions.append(\n        \"(`tabMaterial Request`.owner = %(user)s OR `tabMaterial Request`.purpose = 'Purchase')\"\n    )\n",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-12-02 22:47:17.514591",
  "module": null,
  "name": "kkkk",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Material Request",
  "script": "\"`tabMaterial Request`.owner = '{user}' AND `tabMaterial Request`.purpose = 'Purchase'\"",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-12-03 10:04:54.969933",
  "module": null,
  "name": "ggg",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Material Request",
  "script": "roles = frappe.get_roles()\r\n\r\nfilters = {}\r\n\r\nif \"Purchase User\" in roles:\r\n    filters[\"purpose\"] = \"Purchase\"\r\n\r\n\r\n",
  "script_type": "Permission Query"
 },
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 1,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Insert",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-12-03 14:14:18.161082",
  "module": null,
  "name": "dddf",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Material Request",
  "script": "user_roles = frappe.get_roles(frappe.session.user)\r\n\r\n# فقط برای نقش Purchase User محدودیت بذار\r\nif \"Purchase User\" in user_roles:\r\n    conditions.append(\"`tabMaterial Request`.purpose = 'Purchase'\")\r\n",
  "script_type": "Permission Query"
 }
]